function JSONscriptRequest(a){this.fullUrl=a;this.noCacheIE="&noCacheIE="+(new Date).getTime();this.headLoc=document.getElementsByTagName("head").item(0);this.scriptId="JscriptId"+JSONscriptRequest.scriptCounter++}JSONscriptRequest.scriptCounter=1;
JSONscriptRequest.prototype.buildScriptTag=function(){this.scriptObj=document.createElement("script");this.scriptObj.setAttribute("type","text/javascript");this.scriptObj.setAttribute("charset","utf-8");this.scriptObj.setAttribute("src",this.fullUrl+this.noCacheIE);this.scriptObj.setAttribute("id",this.scriptId)};JSONscriptRequest.prototype.removeScriptTag=function(){this.headLoc.removeChild(this.scriptObj)};JSONscriptRequest.prototype.addScriptTag=function(){this.headLoc.appendChild(this.scriptObj)};
var hexcase=0,b64pad="",chrsz=8;function hex_md5(a){return binl2hex(core_md5(str2binl(a),a.length*chrsz))}function b64_md5(a){return binl2b64(core_md5(str2binl(a),a.length*chrsz))}function str_md5(a){return binl2str(core_md5(str2binl(a),a.length*chrsz))}function hex_hmac_md5(a,f){return binl2hex(core_hmac_md5(a,f))}function b64_hmac_md5(a,f){return binl2b64(core_hmac_md5(a,f))}function str_hmac_md5(a,f){return binl2str(core_hmac_md5(a,f))}
function md5_vm_test(){return hex_md5("abc")=="900150983cd24fb0d6963f7d28e17f72"}
function core_md5(a,f){a[f>>5]|=128<<f%32;a[(f+64>>>9<<4)+14]=f;for(var b=1732584193,c=-271733879,d=-1732584194,e=271733878,g=0;g<a.length;g+=16){var j=b,k=c,l=d,n=e;b=md5_ff(b,c,d,e,a[g+0],7,-680876936);e=md5_ff(e,b,c,d,a[g+1],12,-389564586);d=md5_ff(d,e,b,c,a[g+2],17,606105819);c=md5_ff(c,d,e,b,a[g+3],22,-1044525330);b=md5_ff(b,c,d,e,a[g+4],7,-176418897);e=md5_ff(e,b,c,d,a[g+5],12,1200080426);d=md5_ff(d,e,b,c,a[g+6],17,-1473231341);c=md5_ff(c,d,e,b,a[g+7],22,-45705983);b=md5_ff(b,c,d,e,a[g+8],7,
1770035416);e=md5_ff(e,b,c,d,a[g+9],12,-1958414417);d=md5_ff(d,e,b,c,a[g+10],17,-42063);c=md5_ff(c,d,e,b,a[g+11],22,-1990404162);b=md5_ff(b,c,d,e,a[g+12],7,1804603682);e=md5_ff(e,b,c,d,a[g+13],12,-40341101);d=md5_ff(d,e,b,c,a[g+14],17,-1502002290);c=md5_ff(c,d,e,b,a[g+15],22,1236535329);b=md5_gg(b,c,d,e,a[g+1],5,-165796510);e=md5_gg(e,b,c,d,a[g+6],9,-1069501632);d=md5_gg(d,e,b,c,a[g+11],14,643717713);c=md5_gg(c,d,e,b,a[g+0],20,-373897302);b=md5_gg(b,c,d,e,a[g+5],5,-701558691);e=md5_gg(e,b,c,d,a[g+
10],9,38016083);d=md5_gg(d,e,b,c,a[g+15],14,-660478335);c=md5_gg(c,d,e,b,a[g+4],20,-405537848);b=md5_gg(b,c,d,e,a[g+9],5,568446438);e=md5_gg(e,b,c,d,a[g+14],9,-1019803690);d=md5_gg(d,e,b,c,a[g+3],14,-187363961);c=md5_gg(c,d,e,b,a[g+8],20,1163531501);b=md5_gg(b,c,d,e,a[g+13],5,-1444681467);e=md5_gg(e,b,c,d,a[g+2],9,-51403784);d=md5_gg(d,e,b,c,a[g+7],14,1735328473);c=md5_gg(c,d,e,b,a[g+12],20,-1926607734);b=md5_hh(b,c,d,e,a[g+5],4,-378558);e=md5_hh(e,b,c,d,a[g+8],11,-2022574463);d=md5_hh(d,e,b,c,a[g+
11],16,1839030562);c=md5_hh(c,d,e,b,a[g+14],23,-35309556);b=md5_hh(b,c,d,e,a[g+1],4,-1530992060);e=md5_hh(e,b,c,d,a[g+4],11,1272893353);d=md5_hh(d,e,b,c,a[g+7],16,-155497632);c=md5_hh(c,d,e,b,a[g+10],23,-1094730640);b=md5_hh(b,c,d,e,a[g+13],4,681279174);e=md5_hh(e,b,c,d,a[g+0],11,-358537222);d=md5_hh(d,e,b,c,a[g+3],16,-722521979);c=md5_hh(c,d,e,b,a[g+6],23,76029189);b=md5_hh(b,c,d,e,a[g+9],4,-640364487);e=md5_hh(e,b,c,d,a[g+12],11,-421815835);d=md5_hh(d,e,b,c,a[g+15],16,530742520);c=md5_hh(c,d,e,
b,a[g+2],23,-995338651);b=md5_ii(b,c,d,e,a[g+0],6,-198630844);e=md5_ii(e,b,c,d,a[g+7],10,1126891415);d=md5_ii(d,e,b,c,a[g+14],15,-1416354905);c=md5_ii(c,d,e,b,a[g+5],21,-57434055);b=md5_ii(b,c,d,e,a[g+12],6,1700485571);e=md5_ii(e,b,c,d,a[g+3],10,-1894986606);d=md5_ii(d,e,b,c,a[g+10],15,-1051523);c=md5_ii(c,d,e,b,a[g+1],21,-2054922799);b=md5_ii(b,c,d,e,a[g+8],6,1873313359);e=md5_ii(e,b,c,d,a[g+15],10,-30611744);d=md5_ii(d,e,b,c,a[g+6],15,-1560198380);c=md5_ii(c,d,e,b,a[g+13],21,1309151649);b=md5_ii(b,
c,d,e,a[g+4],6,-145523070);e=md5_ii(e,b,c,d,a[g+11],10,-1120210379);d=md5_ii(d,e,b,c,a[g+2],15,718787259);c=md5_ii(c,d,e,b,a[g+9],21,-343485551);b=safe_add(b,j);c=safe_add(c,k);d=safe_add(d,l);e=safe_add(e,n)}return Array(b,c,d,e)}function md5_cmn(a,f,b,c,d,e){return safe_add(bit_rol(safe_add(safe_add(f,a),safe_add(c,e)),d),b)}function md5_ff(a,f,b,c,d,e,g){return md5_cmn(f&b|~f&c,a,f,d,e,g)}function md5_gg(a,f,b,c,d,e,g){return md5_cmn(f&c|b&~c,a,f,d,e,g)}
function md5_hh(a,f,b,c,d,e,g){return md5_cmn(f^b^c,a,f,d,e,g)}function md5_ii(a,f,b,c,d,e,g){return md5_cmn(b^(f|~c),a,f,d,e,g)}function core_hmac_md5(a,f){var b=str2binl(a);if(b.length>16)b=core_md5(b,a.length*chrsz);for(var c=Array(16),d=Array(16),e=0;e<16;e++){c[e]=b[e]^909522486;d[e]=b[e]^1549556828}b=core_md5(c.concat(str2binl(f)),512+f.length*chrsz);return core_md5(d.concat(b),640)}function safe_add(a,f){var b=(a&65535)+(f&65535);return(a>>16)+(f>>16)+(b>>16)<<16|b&65535}
function bit_rol(a,f){return a<<f|a>>>32-f}function str2binl(a){for(var f=[],b=(1<<chrsz)-1,c=0;c<a.length*chrsz;c+=chrsz)f[c>>5]|=(a.charCodeAt(c/chrsz)&b)<<c%32;return f}function binl2str(a){for(var f="",b=(1<<chrsz)-1,c=0;c<a.length*32;c+=chrsz)f+=String.fromCharCode(a[c>>5]>>>c%32&b);return f}function binl2hex(a){for(var f=hexcase?"0123456789ABCDEF":"0123456789abcdef",b="",c=0;c<a.length*4;c++)b+=f.charAt(a[c>>2]>>c%4*8+4&15)+f.charAt(a[c>>2]>>c%4*8&15);return b}
function binl2b64(a){for(var f="",b=0;b<a.length*4;b+=3)for(var c=(a[b>>2]>>8*(b%4)&255)<<16|(a[b+1>>2]>>8*((b+1)%4)&255)<<8|a[b+2>>2]>>8*((b+2)%4)&255,d=0;d<4;d++)f+=b*8+d*6>a.length*32?b64pad:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>6*(3-d)&63);return f}if(!info)var info={};if(!info.aaronland)info.aaronland={};if(!info.aaronland.flickr)info.aaronland.flickr={};
info.aaronland.flickr.API=function(a){this.args=a;this._host="api.flickr.com";this._endpoint="/services/rest";this.canhas_console=typeof console=="object"?1:0};info.aaronland.flickr.API.prototype.api_call=function(a,f){this.log("calling: "+a);f.noCacheIE=(new Date).getTime();this.json_request(this.api_call_url(a,f),1)};
info.aaronland.flickr.API.prototype.api_call_url=function(a,f){f.api_key=this.args.key;f.method=a;f.format="json";f.nojsoncallback=1;if(f.auth_token&&!f.api_sig){var b=this.sign_args(f);f.api_sig=b}b=[];for(prop in f){var c=prop+"="+encodeURIComponent(f[prop]);b.push(c)}c="http://"+this._host+this._endpoint;c+="?";c+=b.join("&");this.log("request: "+c);return c};
info.aaronland.flickr.API.prototype.sign_args=function(a){var f=[],b="";for(c in a)f.push(c);f.sort();for(i in f){var c=f[i];b+=c+a[c]}this.log("signing: ********"+b);return hex_md5(this.args.secret+b)};info.aaronland.flickr.API.prototype.json_request=function(a,f){jsr=new JSONscriptRequest(a);if(f)jsr.noCacheIE="";jsr.buildScriptTag();jsr.addScriptTag()};info.aaronland.flickr.API.prototype.log=function(a){this.args.enable_logging&&this.canhas_console&&console.log("[flickr] "+a)};info||(info={});if(!info.aaronland)info.aaronland={};if(!info.aaronland.geo)info.aaronland.geo={};info.aaronland.geo.GeocoderResult=function(a,f,b,c,d){this.provider=a;this.query=f;this.lat=b;this.lon=c;this.zoom=d};info.aaronland.geo.GeocoderError=function(a,f,b){this.provider=a;this.query=f;this.message=b};
info.aaronland.geo.GeocoderCapabilities=function(a){this.can_geocode=this.has_geocoder_us=this.has_geonames=this.has_placemaker=this.has_flickr=this.has_cloudmade=this.has_bing=this.has_google=0;this.providers=[];if(typeof google=="object"){this.has_google=1;this.can_geocode+=1;this.providers.push("google")}if(typeof CM=="object"&&typeof CM.Geocoder=="function"){this.has_cloudmade=1;this.can_geocode+=1;if(a&&!a.cloudmade_apikey){this.has_cloudmade=0;this.can_geocode-=1}else this.providers.push("cloudmade")}if(typeof info.aaronland.flickr==
"object"){this.has_flickr=1;this.can_geocode+=1;if(a&&!a.flickr_apikey){this.has_flickr=0;this.can_geocode-=1}else this.providers.push("flickr")}if(typeof Placemaker=="object"){this.has_placemaker=1;this.can_geocode+=1;if(a&&!a.placemaker_apikey){this.has_placemaker=0;this.can_geocode-=1}else this.providers.push("placemaker")}if(typeof VEMap=="function"){this.has_bing=1;this.can_geocode+=1;this.providers.push("bing")}};
info.aaronland.geo.Geocoder=function(a){this.args=a;this.capabilities=new info.aaronland.geo.GeocoderCapabilities(a);this.providers=this.capabilities.providers;if(a.providers)this.providers=a.providers;this.canhas_console=typeof console=="object"?1:0;this.on_fail=this.on_success=this.current_query=this.current_provider=this.timer_geocode=null};
info.aaronland.geo.Geocoder.prototype.geocode=function(a,f,b,c){if(this.timer_geocode){this.log("terminating previously geocoding operation");clearTimeout(this.timer_geocode);this.timer_geocode=null}if(typeof c=="undefined")c=0;var d=c==0?1500:0,e=this;this.timer_geocode=setTimeout(function(){var g=e.providers[c];e.current_provider=g;e.current_query=a;e.log("geocode w/ "+g);var j=b;if(c<e.providers.length&&c!=e.providers.length){var k=c+1,l=e.providers[k];j=function(){e.log("geocoding failed, trying again w/ "+
l);e.geocode(a,f,b,k)}}e.on_success=f;e.on_fail=j;if(g=="bing")e._bing();else if(g=="cloudmade")e._cloudmade();else if(g=="flickr")e._flickr();else if(g=="geocoder.us")e._geocoder_us();else if(g=="geonames")e._geonames();else if(g=="google")e._google();else g=="placemaker"?e._placemaker():e.error("unknown provider")},d);this.log("query for '"+a+"' will be dispatched in "+d+"ms")};
info.aaronland.geo.Geocoder.prototype._google=function(){if(this.capabilities.has_google){var a=this;(new google.maps.Geocoder).geocode({address:this.current_query},function(f,b){if(b!=google.maps.GeocoderStatus.OK)a.error("server error");else if(!f||!f.length)a.error("no results");else{loc=f[0].geometry;lat=loc.location.lat();lon=loc.location.lng();type=loc.location_type;zoom=type==google.maps.GeocoderLocationType.ROOFTOP?17:type==google.maps.GeocoderLocationType.RANGE_INTERPOLATED?15:type==google.maps.GeocoderLocationType.GEOMETRIC_CENTER?
13:11;a.success(lat,lon,zoom)}});this.log("google geocoding request dispatched")}else this.error("missing libraries")};
info.aaronland.geo.Geocoder.prototype._bing=function(){if(this.capabilities.has_bing){var a=this,f=document.createElement("div");f.setAttribute("id","invisible_map");f.setAttribute("style","display:none");document.body.appendChild(f);f=new VEMap("invisible_map");f.LoadMap();f.Find(null,this.current_query,null,null,null,null,null,null,null,null,function(b,c,d,e,g){if(d==null)a.error("no results: "+g);else{b=d[0].LatLong;a.success(b.Latitude,b.Longitude,17)}});this.log("bing geocoding request dispatched")}else this.error("missing libraries")};
info.aaronland.geo.Geocoder.prototype._flickr=function(){if(this.capabilities.has_flickr){var a=this;window._flickrGeocodeComplete=function(b){if(b.stat=="fail")a.error("received (failed) response from flickr");else{var c=b.places.total;if(c){c>1&&a.log("geocoding returned "+c+" results, using the first...");var d=b.places.place[0];b=d.latitude;c=d.longitude;d=d.place_type;zoom=d=="neighbourhood"?15:d=="locality"?13:d=="county"?10:d=="country"?7:3;a.success(b,c,zoom)}else a.error("received (failed) response from flickr")}};
var f=new info.aaronland.flickr.API({key:this.args.flickr_apikey,enable_logging:this.args.enable_logging});f.api_call("flickr.places.find",{query:this.current_query,jsoncallback:"_flickrGeocodeComplete"});this.log("query dispatched to "+f)}else this.error("missing flickr libraries or api key")};info.aaronland.geo.Geocoder.prototype._geonames=function(){this.error("geonames support not complete")};
info.aaronland.geo.Geocoder.prototype._cloudmade=function(){if(this.capabilities.has_cloudmade){var a=this;(new CM.Geocoder(this.args.cloudmade_apikey)).getLocations(this.current_query,function(f){if(f.found){f=f.features[0].centroid.coordinates;a.success(f[0],f[1],null)}else a.error("received (failed) response from cloudmade")});this.log("query dispatched to cloudmade")}else this.error("missing cloudmade libraries or api key")};
info.aaronland.geo.Geocoder.prototype._placemaker=function(){if(this.capabilities.has_placemaker){var a=this;Placemaker.config.appID=this.args.placemaker_apikey;Placemaker.getPlaces(this.current_query,function(f){if(f.error)a.error(f.error);else{f=f.match;f=typeof f[0]=="undefined"?f.place:f[0].place;var b=f.centroid.latitude,c=f.centroid.longitude,d=2;switch(f.type){case "Suburb":d=14;break;case "Town":d=12;break;case "County":d=10;break;case "State":d=7;break;default:d=5;break}a.success(b,c,d)}},
"en-us");this.log("query dispatched to placemaker")}else this.err("missing placemaker libraries or api key")};info.aaronland.geo.Geocoder.prototype._geocoder_us=function(){this.error("geocoder.us support not complete")};info.aaronland.geo.Geocoder.prototype.success=function(a,f,b){this.log(this.current_provider+" returned OK: "+a+","+f+","+b);this.on_success(new info.aaronland.geo.GeocoderResult(this.current_provider,this.current_query,a,f,b))};
info.aaronland.geo.Geocoder.prototype.error=function(a){this.log(this.current_provider+" failed: "+a);this.on_fail(new info.aaronland.geo.GeocoderError(this.current_provider,this.current_query,a))};info.aaronland.geo.Geocoder.prototype.log=function(a){this.args.enable_logging&&this.canhas_console&&console.log("[geocoder] "+a)};var debug=false,show_tile_monitor=true,pm=org.polymaps,map=null,tile_server="/201008/tiles",zoomable_places=[[36.893089,-123.533684,38.8643,-121.208199],[51.261318,-0.563,51.686031,0.28036],[40.495682,-74.255653,40.917622,-73.689484],[32.800701,-118.944817,34.823299,-117.646187],[48.658291,2.08679,49.04694,2.63791],[45.402161,-73.999939,45.704788,-73.476097],[38.713249,-9.2483,38.818378,-9.10876],[53.571571,-0.48939,53.93882,0.14897],[29.39027,-95.893944,30.236691,-94.943367],[30.060181,-97.935928,
30.519581,-97.5634],[32.545391,-97.038422,32.989849,-96.516907],[42.031712,-83.55191,42.451019,-82.869904],[-34.18961,150.517166,-33.57814,151.342575],[-35.22105,138.465378,-34.650799,138.763474],[41.4697,-88.263779,42.154339,-87.52449],[-36.957574,174.645538,-36.79279,174.91745]];function is_zoomable(a,f){for(var b in zoomable_places){var c=zoomable_places[b][1],d=zoomable_places[b][2],e=zoomable_places[b][3];if(a>zoomable_places[b][0]&&a<d&&f>c&&f<e)return true}return false}function show_submit(a){document.getElementById("submit").style.display=a?"inline":"none"}
function geocode(){var a=document.forms[0].q.value,f=document.getElementById("feedback"),b=document.getElementById("instructions");b.style.display="none";f.style.display="block";var c=function(){show_submit(0);f.style.display="none";b.style.display="block"};a=a.replace(/^\s*/,"").replace(/\s*$/,"");if(a==""){f.innerHTML="you forgot to type a placename!";setTimeout(c,2500)}else{(new info.aaronland.geo.Geocoder({flickr_apikey:"cd3517b0f24fb371b1d4018fbdf84b59",enable_logging:true})).geocode(a,function(d){var e=
parseFloat(d.lat),g=parseFloat(d.lon);d=parseInt(d.zoom);if(d<9)d+=3;if(d>9)d=9;f.innerHTML="loading...";map.center({lat:e,lon:g});map.zoom(d);setTimeout(c,2500)},function(d){f.innerHTML="your query failed with the following error: "+d.message;setTimeout(c,7500)});f.innerHTML="searching..."}}document.onkeydown=function(a){if(a.keyCode==27){a=document.getElementById("footer");var f=a.style.display;if(f=="")f="none";a.style.display=f=="none"?"block":"none"}};function tilestache(a){function f(b){b=String(b);var c=6-b.length;b=c<1?b:Array(c+1).join("0")+b;return b.substr(0,3)+"/"+b.substr(3)}return function(b){var c=1<<b.zoom,d=b.column%c;if(d<0)d+=c;return a.replace(/{(.)}/g,function(e,g){switch(g){case "Z":return b.zoom;case "X":return f(d);case "Y":return f(b.row)}return g})}};function goto_staticmap(){var a=map.center();a="/201008/static/#"+map.zoom()+"/"+a.lat+"/"+a.lon;location.href=a}function tilestache(a){function f(b){b=String(b);var c=6-b.length;b=c<1?b:Array(c+1).join("0")+b;return b.substr(0,3)+"/"+b.substr(3)}return function(b){var c=1<<b.zoom,d=b.column%c;if(d<0)d+=c;return a.replace(/{(.)}/g,function(e,g){switch(g){case "Z":return b.zoom;case "X":return f(d);case "Y":return f(b.row)}return g})}}
function whereami(a,f){var b=document.getElementById("whereami");b.innerHTML=a;if(debug&&f)b.innerHTML+='<div class="ima">aka a "'+f+'"</div>';b.style.display="block"}function hide_whereami(){var a=document.getElementById("whereami");a.innerHTML="";a.style.display="none"}
function onload_geojson(a){var f=a.features.length;if(f){map.zoom();for(var b=0;b<f;b++){var c=a.features[b];if(c.data.properties.featurecla){e="Untitled Urban Area #"+c.data.id;c.element.setAttribute("class","naturalearth urbanarea");c.element.setAttribute("onmouseover",'whereami("'+e+'");')}else if(c.data.properties.woe_id){var d="locality";parts=c.data.properties.label.split(", ");parts.pop();if(parts.length==4){parts.pop();parts.pop();d="neighbourhood"}e=parts.join(", ");c.element.setAttribute("class",
"woe "+d);c.element.setAttribute("onmouseover",'whereami("'+e+'");')}else{var e=c.data.properties.name;d=c.data.properties.highway;if(e=="null"||e==null)e="Untitled OSM Feature #"+c.data.id;c.element.setAttribute("class","osm "+d);c.element.setAttribute("onmouseover",'whereami("'+e+'", "'+d+'");')}c.element.setAttribute("onmouseout","hide_whereami();")}}}function toggle_slow_notice(a){document.getElementById("slow").style.display=a?"block":"none"}
function load_prettymaps(){var a=pm.svg("svg");a.setAttribute("id","bucket");a=document.body.appendChild(a);var f=pm.image();f.url(tilestache(tile_server+"/flurban-ground/{Z}/{X}/{Y}.png"));var b=pm.image();b.url(tilestache(tile_server+"/flurban-noground/{Z}/{X}/{Y}.png"));var c=pm.image();c.url(tilestache(tile_server+"/osm/{Z}/{X}/{Y}.png"));var d=pm.image();d.url(tilestache(tile_server+"/urbanareas/{Z}/{X}/{Y}.png"));var e=pm.geoJson();e.url(tilestache(tile_server+"/urbanareas.json/{Z}/{X}/{Y}.json"));
e.clip(false);e.visible(false);e.on("load",onload_geojson);var g=pm.geoJson();g.url(tilestache(tile_server+"/highways.json/{Z}/{X}/{Y}.json"));g.clip(false);g.visible(false);g.on("load",onload_geojson);var j=pm.geoJson();j.url(tilestache(tile_server+"/roads.json/{Z}/{X}/{Y}.json"));j.clip(false);j.visible(false);j.on("load",onload_geojson);var k=pm.geoJson();k.url(tilestache(tile_server+"/people.json/{Z}/{X}/{Y}.json"));k.clip(false);k.visible(false);k.on("load",onload_geojson);var l=pm.geoJson();
l.url(tilestache(tile_server+"/localities.json/{Z}/{X}/{Y}.json"));l.clip(false);l.visible(false);l.on("load",onload_geojson);var n=pm.geoJson();n.url(tilestache(tile_server+"/neighbourhoods.json/{Z}/{X}/{Y}.json"));n.clip(false);n.visible(false);n.on("load",onload_geojson);var q=pm.interact(),r=pm.hash();map=pm.map();map.container(a);map.center({lat:19.366349,lon:-103.083425});map.zoomRange([2,15]);map.zoom(2);if(show_tile_monitor){var o=document.getElementById("monitor");setInterval(function(){var h=
pm.queue.active(),m=pm.queue.count();if(!h&&!m){if(o.innerHTML!=""){o.innerHTML="";o.style.display="none"}}else{h="tiles being processed: "+(h+m);h+='<div id="why"><a href="#" onclick="toggle_slow_notice(1); return false;">why does it take so long?</a></div>';o.innerHTML=h;o.style.display="block"}},500)}map.add(f);map.add(b);map.add(c);map.add(d);map.add(n);map.add(g);map.add(j);map.add(k);map.add(e);map.add(l);map.on("move",function(){var h=map.zoom(),m=map.zoomRange();h=m[1];m=map.center();var p=
false;if(is_zoomable(m.lat,m.lon)){h!=15&&map.zoomRange([2,15]);p=true}else h!=10&&map.zoomRange([2,10]);h=map.zoom();m=map.zoomRange();var s=document.getElementById("near"),t=document.getElementById("far"),u=h<=m[0]?"none":"block";s.style.display=h>=m[1]?"none":"block";t.style.display=u;d.visible(h>=2&&h<=8?true:false);e.visible(h>=4&&h<=8?true:false);g.visible(h>=9&&h<=11?true:false);j.visible(h>=12?true:false);k.visible(h>=13?true:false);if(p){l.visible(h>=8&&h<=11?true:false);n.visible(h==12||
h==13?true:false)}else l.visible(h>=8&&h<=10?true:false)});map.add(q);map.add(r);a=pm.touch();map.add(a)};
